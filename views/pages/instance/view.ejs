<%- include('../../partials/header') %>
<style>
    /* Add your custom styles here */
</style>
<div class="padded">
<h1>Assistant details</h1>
<div id="res" class="alert"></div>

<div>
    <h2>Assistant information</h2>
    <p><strong>Name:</strong> <span id="instanceName"></span></p>
    <p><strong>Description:</strong> <span id="instanceDescription"></span></p>
    <p><strong>Created Date:</strong> <span id="instanceCreatedAt"></span></p>
    <p><strong>Updated Date:</strong> <span id="instanceUpdatedAt"></span></p>
    <p><strong>Public:</strong> <span id="instancePublic"></span></p>
</div>
<button id="chatBtn">Chat with assistant</button>

<h3>Manage assistant</h3>
<button id="editInstanceBtn">Edit assistant</button>
<button id="deleteInstanceBtn">Delete assistant</button>
<button id="manageSourcesBtn">Manage Sources</button>

<h3>Ratings report</h3>
<button id="ratingsReportBtn">Ratings report</button>
</div>

<script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
<script>
    document.addEventListener("DOMContentLoaded", function () {
        const instanceId = "<%= instanceId %>";
        fetch(`/instances/${instanceId}`, {
            headers: {
                'Accept': 'application/json'
            }
        })
        .then(response => response.json())
        .then(instance => {
            document.getElementById('instanceName').textContent = instance.name;
            document.getElementById('instanceDescription').textContent = instance.description || 'No description available';
            document.getElementById('instanceCreatedAt').textContent = new Date(instance.createdAt).toLocaleString();
            document.getElementById('instanceUpdatedAt').textContent = new Date(instance.updatedAt).toLocaleString();
            document.getElementById('instancePublic').textContent = instance.public ? 'Yes' : 'No';
        })
        .catch(error => {
            console.error('Error fetching instance details:', error);
            document.getElementById('res').textContent = 'Error fetching instance details.';
        });

        document.getElementById('editInstanceBtn').addEventListener('click', function () {
            window.location.href = `/instances/${instanceId}/edit`;
        });

        document.getElementById('deleteInstanceBtn').addEventListener('click', function () {
            if (confirm('Are you sure you want to delete this instance?')) {
                document.getElementById('res').textContent = 'Deleting, please wait.';
                fetch(`/instances/${instanceId}`, {
                    method: 'DELETE',
                })
                .then(response => {
                    if (response.ok) {
                        document.getElementById('res').textContent = 'Instance deleted successfully.';
                        setTimeout(function () {
                            window.location.href = '/instances';
                        }, 2000);
                    } else {
                        document.getElementById('res').textContent = 'Error deleting instance.';
                    }
                })
                .catch(error => {
                    console.error('Error deleting instance:', error);
                    document.getElementById('res').textContent = 'Error deleting instance.';
                });
            }
        });

        document.getElementById('manageSourcesBtn').addEventListener('click', function () {
            window.location.href = `/instances/${instanceId}/sources`;
        });

        document.getElementById('chatBtn').addEventListener('click', function () {
            window.location.href = `/instances/${instanceId}/conversations`;
        });

        document.getElementById('ratingsReportBtn').addEventListener('click', function () {
            window.location.href = `/instances/${instanceId}/ratingsReport`;
        });
    });
</script>
<%- include('../../partials/footer') %>